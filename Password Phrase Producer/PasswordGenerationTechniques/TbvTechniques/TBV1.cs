using Password_Phrase_Producer.PasswordGenerationTechniques.TbvTechniques;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace PasswordPhraseProducer.PasswordGenerationTechniques.TbvTechniques
{
    internal class TBV1 : Itbv
    {
        private readonly string allCharacters = "uK9@bR]fVQ2!M4A>€c)X0a^Häe=,1§DköU#YxgÄl²3B_q&Zs$8nO*C.6d~P%tL5{hS<p7³vÜz}?EÖw(yN°r/J[Fo´i`Iü|W'j+;m-G:T";
        private readonly string[] allCharactersArray = {
            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

            "u", "K", "9", "@", "b", "R", "]", "f", "V", "Q", "2", "!", "M", "4", "A", ">", "€", "c",
            ")", "X", "0", "a", "^", "H", "ä", "e", "=", ",", "1", "§", "D", "k", "ö", "U", "#", "Y", "x", "g", "Ä",
            "l", "²", "3", "B", "_", "q", "&", "Z", "s", "$", "8", "n", "O", "*", "C", ".", "6", "d", "~", "P", "%",
            "t", "L", "5", "{", "h", "S", "<", "p", "7", "³", "v", "Ü", "z", "}", "?", "E", "Ö", "w", "(", "y", "N",
            "°", "r", "/", "J", "[", "F", "o", "´", "i", "`", "I", "ü", "|", "W", "'", "j", "+", ";", "m", "-", "G",
            ":", "T",

        };

        private TBVHelper helper = new TBVHelper();
        private string resultWithoutSpaces = string.Empty;
        public static bool IsCancelled { get; set; } = false;


        public string GeneratePassword(string plainTextPassword, int code1, int code2, int code3)
        {
            if (IsCancelled) return "";

            char[] passwordChars = plainTextPassword.ToCharArray();
            int[] encodedNumbers = new int[passwordChars.Length];
            string encryptedPassword = " ";

            for (int i = 0; i < passwordChars.Length; i++)
            {
                if (IsCancelled) return "";

                encodedNumbers[i] = allCharacters.IndexOf(passwordChars[i]);
                encodedNumbers[i] = (encodedNumbers[i] * code1 + (code2 * 3) / code2 + code3);

                if (encodedNumbers[i] > 104)
                {
                    encodedNumbers[i] = helper.ValidateIndex(encodedNumbers[i], 104);
                }

                encryptedPassword += allCharactersArray[helper.ValidateIndex(encodedNumbers[i], 104)];
            }

            for (int i = 0; i < code1; i++)
            {
                if (IsCancelled) return "";

                encryptedPassword += allCharactersArray[helper.ValidateIndex(code1 + code2 * code3 + code1 * i, 104)];
                encryptedPassword += allCharactersArray[helper.ValidateIndex(code3 * i + (code1 + code1), 104)];
                encryptedPassword += allCharactersArray[helper.ValidateIndex((code2 * i + code2) * 2 + i + (code1 - i + code3) - 3 + i, 104)];
            }

            string reversedPassword = new string(encryptedPassword.Reverse().ToArray());
            char[] reversedChars = reversedPassword.ToCharArray();
            char[] encryptedChars = encryptedPassword.ToCharArray();

            string finalPassword = "";
            for (int i = 0; i < encryptedPassword.Length; i++)
            {
                if (IsCancelled) return "";

                finalPassword += allCharactersArray[helper.ValidateIndex(code3 - 1, 104)];
                finalPassword += encryptedChars[i];
                finalPassword += allCharactersArray[helper.ValidateIndex(code1 + code2 + 4 * 3, 104)];
                finalPassword += reversedChars[i];
            }

            resultWithoutSpaces = finalPassword.Replace(" ", "");
            return resultWithoutSpaces;
        }
    }
}