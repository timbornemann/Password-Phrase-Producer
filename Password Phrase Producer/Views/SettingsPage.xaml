<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Password_Phrase_Producer.Views.SettingsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:Password_Phrase_Producer.Converters"
    xmlns:viewmodels="clr-namespace:Password_Phrase_Producer.ViewModels"
    Padding="0"
    Shell.NavBarIsVisible="False">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:StringNotNullOrWhiteSpaceConverter x:Key="StringNotNullOrWhiteSpaceConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#101018" Offset="0" />
            <GradientStop Color="#141426" Offset="0.6" />
            <GradientStop Color="#0F111A" Offset="1" />
        </LinearGradientBrush>
    </ContentPage.Background>

    <Grid RowDefinitions="Auto,*">
        <!-- Header -->
        <Grid
            Padding="16,16,16,10"
            ColumnDefinitions="Auto,*,Auto"
            ColumnSpacing="10">
            
            <!-- Hamburger Menu -->
            <Border
                WidthRequest="34"
                HeightRequest="34"
                BackgroundColor="#1F2338"
                StrokeThickness="0"
                VerticalOptions="Center">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="#25000000" Radius="6" Offset="0,3" />
                </Border.Shadow>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnOpenFlyoutTapped" />
                </Border.GestureRecognizers>
                <Image
                    Source="menu.png"
                    WidthRequest="18"
                    HeightRequest="18"
                    HorizontalOptions="Center"
                    VerticalOptions="Center" />
            </Border>

            <Label 
                Grid.Column="1"
                Text="Einstellungen"
                FontSize="18"
                FontAttributes="Bold"
                TextColor="White"
                VerticalOptions="Center" />

            <!-- Back Button -->
            <Border
                Grid.Column="2"
                WidthRequest="34"
                HeightRequest="34"
                BackgroundColor="#1F2338"
                StrokeThickness="0"
                HorizontalOptions="End"
                VerticalOptions="Center">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="#25000000" Radius="6" Offset="0,3" />
                </Border.Shadow>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnBackTapped" />
                </Border.GestureRecognizers>
                <Image
                    Source="chevronright.png"
                    WidthRequest="18"
                    HeightRequest="18"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    Rotation="0" />
            </Border>
        </Grid>

        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="16,0,16,24" Spacing="16">
                <Border
                    BackgroundColor="#1B2036"
                    Padding="14"
                    StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="#25000000" Radius="12" Offset="0,6" />
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="10">
                        <Label
                            Text="Gesamtbackup"
                            FontSize="16"
                            FontAttributes="Bold"
                            TextColor="White" />
                        <Label
                            Text="Exportiere oder importiere alle Daten (Passwort-Tresor, Datentresor und Authenticator) in einer Datei. Alle Bereiche müssen entsperrt sein."
                            FontSize="12"
                            TextColor="#9EA3C4" />
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                            <Button
                                Text="Alles exportieren"
                                Clicked="OnExportFullBackupClicked"
                                BackgroundColor="#4A5CFF"
                                TextColor="White"
                                FontSize="11"
                                Padding="8,6"
                                CornerRadius="10" />
                            <Button
                                Grid.Column="1"
                                Text="Alles importieren"
                                Clicked="OnImportFullBackupClicked"
                                BackgroundColor="#1F2338"
                                TextColor="White"
                                FontSize="11"
                                Padding="8,6"
                                CornerRadius="10" />
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- Synchronization Section -->
                <Border
                    BackgroundColor="#1B2036"
                    Padding="14"
                    StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="#25000000" Radius="12" Offset="0,6" />
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="10">
                        <Label
                            Text="Synchronisation"
                            FontSize="16"
                            FontAttributes="Bold"
                            TextColor="White" />
                        <Label
                            Text="Synchronisiere deine Tresore über eine externe verschlüsselte Datei."
                            FontSize="12"
                            TextColor="#9EA3C4" />

                        <Label
                            Text="Status"
                            FontSize="12"
                            TextColor="#9EA3C4" />
                        <Label
                            Text="{Binding SyncStatusMessage}"
                            FontSize="13"
                            FontAttributes="Bold"
                            TextColor="{Binding SyncStatusColor}" />

                        <Label
                            Text="Dateipfad"
                            FontSize="12"
                            TextColor="#9EA3C4"
                            Margin="0,8,0,0" />
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                            <Entry
                                Text="{Binding SyncPath}"
                                Placeholder="Pfad zur Sync-Datei"
                                PlaceholderColor="#7F85B2"
                                TextColor="White"
                                BackgroundColor="#1F2338"
                                FontSize="13"
                                HeightRequest="38" />
                            <HorizontalStackLayout Grid.Column="1" Spacing="4">
                                <Button
                                    Text="Neu"
                                    Command="{Binding CreateSyncFileCommand}"
                                    BackgroundColor="#2D324A"
                                    TextColor="White"
                                    FontSize="11"
                                    Padding="8,0"
                                    HeightRequest="38"
                                    CornerRadius="8" />
                                <Button
                                    Text="..."
                                    Command="{Binding PickSyncFileCommand}"
                                    BackgroundColor="#2D324A"
                                    TextColor="White"
                                    WidthRequest="40"
                                    HeightRequest="38"
                                    Padding="0"
                                    CornerRadius="8" />
                            </HorizontalStackLayout>
                        </Grid>

                        <Label
                            Text="Sync-Passwort"
                            FontSize="12"
                            TextColor="#9EA3C4" />
                        <Entry
                            Text="{Binding SyncPassword}"
                            Placeholder="Passwort festlegen"
                            PlaceholderColor="#7F85B2"
                            TextColor="White"
                            BackgroundColor="#1F2338"
                            IsPassword="True"
                            FontSize="13"
                            HeightRequest="38" />

                        <Button
                            Text="Synchronisation einrichten"
                            Command="{Binding ConfigureSyncCommand}"
                            BackgroundColor="#4A5CFF"
                            TextColor="White"
                            FontSize="13"
                            Padding="12,8"
                            CornerRadius="12"
                            Margin="0,8,0,0">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" Binding="{Binding IsSyncBusy}" Value="True">
                                    <Setter Property="IsEnabled" Value="False" />
                                    <Setter Property="Text" Value="Wird eingerichtet..." />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                        
                        <Button
                            Text="Jetzt synchronisieren"
                            Clicked="OnManualSyncClicked"
                            BackgroundColor="#1F2338"
                            TextColor="White"
                            FontSize="13"
                            Padding="12,8"
                            CornerRadius="12"
                            Margin="0,0,0,0">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" Binding="{Binding IsSyncBusy}" Value="True">
                                    <Setter Property="IsEnabled" Value="False" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>

                        <Button
                            Text="Nur laden (kein Upload)"
                            Clicked="OnLoadSyncClicked"
                            BackgroundColor="#2D324A"
                            TextColor="White"
                            FontSize="13"
                            Padding="12,8"
                            CornerRadius="12"
                            Margin="0,0,0,0">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" Binding="{Binding IsSyncBusy}" Value="True">
                                    <Setter Property="IsEnabled" Value="False" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>

                        <Button
                            Text="Sync-Verbindung löschen"
                            Clicked="OnRemoveSyncClicked"
                            BackgroundColor="#FF4444"
                            TextColor="White"
                            FontSize="13"
                            Padding="12,8"
                            CornerRadius="12"
                            Margin="0,8,0,0">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" Binding="{Binding IsSyncBusy}" Value="True">
                                    <Setter Property="IsEnabled" Value="False" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>

                        <VerticalStackLayout Spacing="4" Margin="0,8,0,0">
                             <Label Text="Letzte Synchronisation:" FontSize="12" TextColor="#9EA3C4" FontAttributes="Bold"/>
                             <Label Text="{Binding PasswordVaultSyncTime, StringFormat='Passwörter: {0:g}'}" FontSize="11" TextColor="#7F85B2"/>
                             <Label Text="{Binding DataVaultSyncTime, StringFormat='Datentresor: {0:g}'}" FontSize="11" TextColor="#7F85B2"/>
                             <Label Text="{Binding AuthenticatorSyncTime, StringFormat='Authenticator: {0:g}'}" FontSize="11" TextColor="#7F85B2"/>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <Border
                    BackgroundColor="#1B2036"
                    Padding="14"
                    StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="#25000000" Radius="12" Offset="0,6" />
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="10">
                        <Label
                            Text="App-Passwort"
                            FontSize="16"
                            FontAttributes="Bold"
                            TextColor="White" />
                        <Label
                            Text="Ändere dein App-Passwort, das den Zugriff auf die App schützt."
                            TextColor="#9EA3C4"
                            FontSize="12" />

                        <Label
                            Text="Aktuelles App-Passwort"
                            TextColor="#9EA3C4"
                            FontSize="12">
                            <Label.Triggers>
                                <DataTrigger TargetType="Label" Binding="{Binding HasAppPassword}" Value="False">
                                    <Setter Property="IsVisible" Value="False" />
                                </DataTrigger>
                            </Label.Triggers>
                        </Label>
                        <Entry
                            Text="{Binding CurrentAppPassword}"
                            Placeholder="Aktuelles App-Passwort"
                            PlaceholderColor="#7F85B2"
                            TextColor="White"
                            BackgroundColor="#1F2338"
                            IsPassword="True"
                            FontSize="13"
                            HeightRequest="38">
                            <Entry.Triggers>
                                <DataTrigger TargetType="Entry" Binding="{Binding HasAppPassword}" Value="False">
                                    <Setter Property="IsVisible" Value="False" />
                                </DataTrigger>
                            </Entry.Triggers>
                        </Entry>

                        <Entry
                            Text="{Binding NewAppPassword}"
                            Placeholder="Neues App-Passwort"
                            PlaceholderColor="#7F85B2"
                            TextColor="White"
                            BackgroundColor="#1F2338"
                            IsPassword="True"
                            FontSize="13"
                            HeightRequest="38" />
                        <Entry
                            Text="{Binding ConfirmAppPassword}"
                            Placeholder="Passwort bestätigen"
                            PlaceholderColor="#7F85B2"
                            TextColor="White"
                            BackgroundColor="#1F2338"
                            IsPassword="True"
                            FontSize="13"
                            HeightRequest="38" />

                        <Grid ColumnDefinitions="Auto,*" IsVisible="{Binding CanUseAppBiometric}">
                            <Switch
                                Grid.Column="0"
                                IsToggled="{Binding EnableAppBiometric}" />
                            <Label
                                Grid.Column="1"
                                Text="Biometrische Anmeldung speichern"
                                FontSize="11"
                                TextColor="#E8EBFF"
                                Margin="10,0,0,0"
                                VerticalOptions="Center"
                                LineBreakMode="WordWrap" />
                        </Grid>

                        <Label
                            Text="{Binding ChangeAppPasswordError}"
                            TextColor="#FF7474"
                            FontSize="11"
                            IsVisible="{Binding ChangeAppPasswordError, Converter={StaticResource StringNotNullOrWhiteSpaceConverter}}" />
                        <Label
                            Text="{Binding ChangeAppPasswordSuccess}"
                            TextColor="#63F5A8"
                            FontSize="11"
                            IsVisible="{Binding ChangeAppPasswordSuccess, Converter={StaticResource StringNotNullOrWhiteSpaceConverter}}" />

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12" VerticalOptions="Center">
                            <Button
                                Text="App-Passwort aktualisieren"
                                Command="{Binding ChangeAppPasswordCommand}"
                                BackgroundColor="#4A5CFF"
                                TextColor="White"
                                FontSize="13"
                                CornerRadius="12"
                                Padding="12,8" />
                            <ActivityIndicator
                                Grid.Column="1"
                                IsRunning="{Binding IsAppPasswordChangeBusy}"
                                IsVisible="{Binding IsAppPasswordChangeBusy}"
                                Color="#63F5A8"
                                WidthRequest="24"
                                HeightRequest="24" />
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <Border
                    BackgroundColor="#1B2036"
                    Padding="14"
                    StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="#25000000" Radius="12" Offset="0,6" />
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="10">
                        <Label
                            Text="Passwort-Tresor-Passwort"
                            FontSize="16"
                            FontAttributes="Bold"
                            TextColor="White" />
                        <Label
                            Text="Gib dein aktuelles Passwort ein, um es zu ändern."
                            TextColor="#9EA3C4"
                            FontSize="12" />

                        <Entry
                            Text="{Binding CurrentMasterPassword}"
                            Placeholder="Aktuelles Master-Passwort"
                            PlaceholderColor="#7F85B2"
                            TextColor="White"
                            BackgroundColor="#1F2338"
                            IsPassword="True"
                            FontSize="13"
                            HeightRequest="38">
                            <Entry.Triggers>
                                <DataTrigger TargetType="Entry" Binding="{Binding IsVaultUnlocked}" Value="True">
                                    <Setter Property="IsVisible" Value="False" />
                                </DataTrigger>
                            </Entry.Triggers>
                        </Entry>
                        <Entry
                            Text="{Binding NewMasterPassword}"
                            Placeholder="Neues Master-Passwort"
                            PlaceholderColor="#7F85B2"
                            TextColor="White"
                            BackgroundColor="#1F2338"
                            IsPassword="True"
                            FontSize="13"
                            HeightRequest="38" />
                        <Entry
                            Text="{Binding ConfirmMasterPassword}"
                            Placeholder="Passwort bestätigen"
                            PlaceholderColor="#7F85B2"
                            TextColor="White"
                            BackgroundColor="#1F2338"
                            IsPassword="True"
                            FontSize="13"
                            HeightRequest="38" />

                        <Grid ColumnDefinitions="Auto,*" IsVisible="{Binding CanUseBiometric}">
                            <Switch
                                Grid.Column="0"
                                IsToggled="{Binding EnableBiometric}" />
                            <Label
                                Grid.Column="1"
                                Text="Biometrische Anmeldung speichern"
                                FontSize="11"
                                TextColor="#E8EBFF"
                                Margin="10,0,0,0"
                                VerticalOptions="Center"
                                LineBreakMode="WordWrap" />
                        </Grid>

                        <Label
                            Text="{Binding ChangePasswordError}"
                            TextColor="#FF7474"
                            FontSize="11"
                            IsVisible="{Binding ChangePasswordError, Converter={StaticResource StringNotNullOrWhiteSpaceConverter}}" />
                        <Label
                            Text="{Binding ChangePasswordSuccess}"
                            TextColor="#63F5A8"
                            FontSize="11"
                            IsVisible="{Binding ChangePasswordSuccess, Converter={StaticResource StringNotNullOrWhiteSpaceConverter}}" />

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12" VerticalOptions="Center">
                            <Button
                                Text="Passwort aktualisieren"
                                Command="{Binding ChangePasswordCommand}"
                                BackgroundColor="#4A5CFF"
                                TextColor="White"
                                FontSize="13"
                                CornerRadius="12"
                                Padding="12,8" />
                            <ActivityIndicator
                                Grid.Column="1"
                                IsRunning="{Binding IsPasswordChangeBusy}"
                                IsVisible="{Binding IsPasswordChangeBusy}"
                                Color="#63F5A8"
                                WidthRequest="24"
                                HeightRequest="24" />
                        </Grid>

                        <Button
                            Text="Passwort-Tresor zurücksetzen"
                            Clicked="OnResetPasswordVaultClicked"
                            BackgroundColor="#FF4444"
                            TextColor="White"
                            FontSize="13"
                            CornerRadius="12"
                            Padding="12,8"
                            Margin="0,8,0,0" />
                    </VerticalStackLayout>
                </Border>

                <Border
                    BackgroundColor="#1B2036"
                    Padding="14"
                    StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="#25000000" Radius="12" Offset="0,6" />
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="10">
                        <Label
                            Text="Datentresor Master-Passwort"
                            FontSize="16"
                            FontAttributes="Bold"
                            TextColor="White" />
                        <Label
                            Text="Gib dein aktuelles Passwort ein, um es zu ändern."
                            TextColor="#9EA3C4"
                            FontSize="12" />

                        <Entry
                            Text="{Binding CurrentDataVaultMasterPassword}"
                            Placeholder="Aktuelles Master-Passwort"
                            PlaceholderColor="#7F85B2"
                            TextColor="White"
                            BackgroundColor="#1F2338"
                            IsPassword="True"
                            FontSize="13"
                            HeightRequest="38">
                            <Entry.Triggers>
                                <DataTrigger TargetType="Entry" Binding="{Binding IsDataVaultUnlocked}" Value="True">
                                    <Setter Property="IsVisible" Value="False" />
                                </DataTrigger>
                            </Entry.Triggers>
                        </Entry>
                        <Entry
                            Text="{Binding NewDataVaultMasterPassword}"
                            Placeholder="Neues Master-Passwort"
                            PlaceholderColor="#7F85B2"
                            TextColor="White"
                            BackgroundColor="#1F2338"
                            IsPassword="True"
                            FontSize="13"
                            HeightRequest="38" />
                        <Entry
                            Text="{Binding ConfirmDataVaultMasterPassword}"
                            Placeholder="Passwort bestätigen"
                            PlaceholderColor="#7F85B2"
                            TextColor="White"
                            BackgroundColor="#1F2338"
                            IsPassword="True"
                            FontSize="13"
                            HeightRequest="38" />

                        <Grid ColumnDefinitions="Auto,*" IsVisible="{Binding CanUseDataVaultBiometric}">
                            <Switch
                                Grid.Column="0"
                                IsToggled="{Binding EnableDataVaultBiometric}" />
                            <Label
                                Grid.Column="1"
                                Text="Biometrische Anmeldung speichern"
                                FontSize="11"
                                TextColor="#E8EBFF"
                                Margin="10,0,0,0"
                                VerticalOptions="Center"
                                LineBreakMode="WordWrap" />
                        </Grid>

                        <Label
                            Text="{Binding ChangeDataVaultPasswordError}"
                            TextColor="#FF7474"
                            FontSize="11"
                            IsVisible="{Binding ChangeDataVaultPasswordError, Converter={StaticResource StringNotNullOrWhiteSpaceConverter}}" />
                        <Label
                            Text="{Binding ChangeDataVaultPasswordSuccess}"
                            TextColor="#63F5A8"
                            FontSize="11"
                            IsVisible="{Binding ChangeDataVaultPasswordSuccess, Converter={StaticResource StringNotNullOrWhiteSpaceConverter}}" />

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12" VerticalOptions="Center">
                            <Button
                                Text="Passwort aktualisieren"
                                Command="{Binding ChangeDataVaultPasswordCommand}"
                                BackgroundColor="#4A5CFF"
                                TextColor="White"
                                FontSize="13"
                                CornerRadius="12"
                                Padding="12,8" />
                            <ActivityIndicator
                                Grid.Column="1"
                                IsRunning="{Binding IsDataVaultPasswordChangeBusy}"
                                IsVisible="{Binding IsDataVaultPasswordChangeBusy}"
                                Color="#63F5A8"
                                WidthRequest="24"
                                HeightRequest="24" />
                        </Grid>

                        <Button
                            Text="Datentresor zurücksetzen"
                            Clicked="OnResetDataVaultClicked"
                            BackgroundColor="#FF4444"
                            TextColor="White"
                            FontSize="13"
                            CornerRadius="12"
                            Padding="12,8"
                            Margin="0,8,0,0" />
                    </VerticalStackLayout>
                </Border>

                <Border
                    BackgroundColor="#1B2036"
                    Padding="14"
                    StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="#25000000" Radius="12" Offset="0,6" />
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="10">
                        <Label
                            Text="Authenticator-Passwort"
                            FontSize="16"
                            FontAttributes="Bold"
                            TextColor="White" />

                        <Label
                            Text="Schützt deine 2FA-Codes. Du kannst hier ein Passwort setzen oder ändern."
                            TextColor="#9EA3C4"
                            FontSize="12" />

                        <Label
                            Text="Aktuelles Authenticator-Passwort"
                            TextColor="#9EA3C4"
                            FontSize="12">
                            <Label.Triggers>
                                <DataTrigger TargetType="Label" Binding="{Binding HasAuthenticatorPassword}" Value="False">
                                    <Setter Property="IsVisible" Value="False" />
                                </DataTrigger>
                            </Label.Triggers>
                        </Label>
                        <Entry
                            Text="{Binding CurrentAuthenticatorPassword}"
                            Placeholder="Aktuelles Passwort"
                            PlaceholderColor="#7F85B2"
                            TextColor="White"
                            BackgroundColor="#1F2338"
                            IsPassword="True"
                            FontSize="13"
                            HeightRequest="38">
                            <Entry.Triggers>
                                <DataTrigger TargetType="Entry" Binding="{Binding HasAuthenticatorPassword}" Value="False">
                                    <Setter Property="IsVisible" Value="False" />
                                </DataTrigger>
                            </Entry.Triggers>
                        </Entry>

                        <Entry
                            Text="{Binding NewAuthenticatorPassword}"
                            Placeholder="Neues Authenticator-Passwort"
                            PlaceholderColor="#7F85B2"
                            TextColor="White"
                            BackgroundColor="#1F2338"
                            IsPassword="True"
                            FontSize="13"
                            HeightRequest="38" />
                        <Entry
                            Text="{Binding ConfirmAuthenticatorPassword}"
                            Placeholder="Passwort bestätigen"
                            PlaceholderColor="#7F85B2"
                            TextColor="White"
                            BackgroundColor="#1F2338"
                            IsPassword="True"
                            FontSize="13"
                            HeightRequest="38" />

                        <Label
                            Text="{Binding ChangeAuthenticatorPasswordError}"
                            TextColor="#FF7474"
                            FontSize="11"
                            IsVisible="{Binding ChangeAuthenticatorPasswordError, Converter={StaticResource StringNotNullOrWhiteSpaceConverter}}" />
                        <Label
                            Text="{Binding ChangeAuthenticatorPasswordSuccess}"
                            TextColor="#63F5A8"
                            FontSize="11"
                            IsVisible="{Binding ChangeAuthenticatorPasswordSuccess, Converter={StaticResource StringNotNullOrWhiteSpaceConverter}}" />

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12" VerticalOptions="Center">
                            <Button
                                Text="Authenticator-Passwort aktualisieren"
                                Command="{Binding ChangeAuthenticatorPasswordCommand}"
                                BackgroundColor="#4A5CFF"
                                TextColor="White"
                                FontSize="13"
                                CornerRadius="12"
                                Padding="12,8" />
                            <ActivityIndicator
                                Grid.Column="1"
                                IsRunning="{Binding IsAuthenticatorPasswordChangeBusy}"
                                IsVisible="{Binding IsAuthenticatorPasswordChangeBusy}"
                                Color="#63F5A8"
                                WidthRequest="24"
                                HeightRequest="24" />
                        </Grid>

                        <Button
                            Text="2FA-Tresor zurücksetzen"
                            Clicked="OnResetAuthenticatorClicked"
                            BackgroundColor="#FF4444"
                            TextColor="White"
                            FontSize="13"
                            CornerRadius="12"
                            Padding="12,8"
                            Margin="0,8,0,0" />
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
