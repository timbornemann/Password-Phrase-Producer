<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Password_Phrase_Producer.Views.VaultPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:Password_Phrase_Producer.Converters"
    xmlns:models="clr-namespace:Password_Phrase_Producer.Models"
    xmlns:viewmodels="clr-namespace:Password_Phrase_Producer.ViewModels"
    Padding="0"
    Shell.NavBarIsVisible="False">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:PasswordMaskConverter x:Key="PasswordMaskConverter" />
            <converters:StringNotNullOrWhiteSpaceConverter x:Key="StringNotNullOrWhiteSpaceConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#101018" Offset="0" />
            <GradientStop Color="#141426" Offset="0.6" />
            <GradientStop Color="#0F111A" Offset="1" />
        </LinearGradientBrush>
    </ContentPage.Background>

    <Grid>
        <Grid RowDefinitions="Auto,*">
            <Grid
                Padding="24,40,24,16"
                RowSpacing="12"
                RowDefinitions="Auto,Auto">
                <Grid
                    ColumnDefinitions="Auto,*,Auto,Auto"
                    ColumnSpacing="16"
                    VerticalOptions="Start">
                    <Border
                        WidthRequest="52"
                        HeightRequest="52"
                        BackgroundColor="#1F2338"
                        StrokeThickness="0"
                        VerticalOptions="Center">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="18" />
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="#25000000" Radius="12" Offset="0,8" />
                        </Border.Shadow>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnBackTapped" />
                        </Border.GestureRecognizers>
                        <Label
                            Text="â†"
                            FontSize="20"
                            HorizontalOptions="Center"
                            VerticalOptions="Center"
                            TextColor="#CFD3FF" />
                    </Border>

                    <VerticalStackLayout Grid.Column="1">
                        <Label
                            Text="Tresor"
                            FontSize="28"
                            FontAttributes="Bold"
                            TextColor="White" />
                    </VerticalStackLayout>

                    <Button
                        Grid.Column="2"
                        Text="ï¼‹ Neuer Eintrag"
                        Clicked="OnAddEntryClicked"
                        HeightRequest="44"
                        Padding="18,10"
                        BackgroundColor="#3B4AD1"
                        TextColor="White"
                        FontAttributes="Bold"
                        CornerRadius="16"
                        IsVisible="{Binding IsUnlocked}"
                        SemanticProperties.Hint="Neuen Tresor-Eintrag hinzufÃ¼gen" />

                    <Border
                        Grid.Column="3"
                        WidthRequest="52"
                        HeightRequest="52"
                        BackgroundColor="#1F2338"
                        StrokeThickness="0"
                        HorizontalOptions="End"
                        VerticalOptions="Center">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="18" />
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="#25000000" Radius="12" Offset="0,8" />
                        </Border.Shadow>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnOpenMenuTapped" />
                        </Border.GestureRecognizers>
                        <Label
                            Text="â˜°"
                            FontSize="20"
                            HorizontalOptions="Center"
                            VerticalOptions="Center"
                            TextColor="#CFD3FF" />
                    </Border>
                </Grid>

                <Grid Grid.Row="1" ColumnDefinitions="*,Auto,Auto" ColumnSpacing="12">
                    <Border
                        BackgroundColor="#1F2338"
                        StrokeThickness="0"
                        Padding="14,10"
                        HorizontalOptions="Fill"
                        VerticalOptions="Center">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="20" />
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="#1A000000" Radius="12" Offset="0,8" />
                        </Border.Shadow>
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                            <Label
                                Text="ðŸ”"
                                FontSize="16"
                                VerticalOptions="Center"
                                TextColor="#CFD3FF" />
                            <Entry
                                Grid.Column="1"
                                Text="{Binding SearchQuery}"
                                Placeholder="Suche im Tresor"
                                PlaceholderColor="#7F85B2"
                                TextColor="White"
                                BackgroundColor="Transparent"
                                ClearButtonVisibility="WhileEditing" />
                        </Grid>
                    </Border>

                    <Border
                        Grid.Column="1"
                        BackgroundColor="#1F2338"
                        StrokeThickness="0"
                        Padding="12,8"
                        HorizontalOptions="End"
                        VerticalOptions="Center">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="20" />
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="#1A000000" Radius="12" Offset="0,8" />
                        </Border.Shadow>
                        <Picker
                            ItemsSource="{Binding CategoryFilterOptions}"
                            SelectedItem="{Binding SelectedCategory}"
                            Title="Kategorie wÃ¤hlen"
                            FontSize="14"
                            TextColor="#E0E4FF"
                            TitleColor="#7F85B2" />
                    </Border>

                    <Border
                        Grid.Column="2"
                        WidthRequest="48"
                        HeightRequest="48"
                        StrokeThickness="0"
                        Padding="0"
                        BackgroundColor="#1F2338"
                        HorizontalOptions="End"
                        VerticalOptions="Center">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="18" />
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="#1A000000" Radius="12" Offset="0,8" />
                        </Border.Shadow>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnVaultActionsTapped" />
                        </Border.GestureRecognizers>
                        <Label
                            Text="âš™"
                            FontSize="20"
                            HorizontalOptions="Center"
                            VerticalOptions="Center"
                            TextColor="#CFD3FF" />
                    </Border>
                </Grid>
            </Grid>

            <CollectionView
                x:Name="VaultCollectionView"
                Grid.Row="1"
                Margin="24,0,24,24"
                ItemsSource="{Binding EntryGroups}"
                SelectionMode="None"
                ItemSizingStrategy="MeasureAllItems"
                VerticalOptions="FillAndExpand"
                VerticalScrollBarVisibility="Never"
                IsGrouped="True">
            <CollectionView.GroupHeaderTemplate>
                <DataTemplate x:DataType="viewmodels:VaultEntryGroup">
                    <Label
                        Text="{Binding Category}"
                        FontSize="18"
                        FontAttributes="Bold"
                        TextColor="#D8DCFF"
                        Margin="0,24,0,12" />
                </DataTemplate>
            </CollectionView.GroupHeaderTemplate>
            <CollectionView.EmptyView>
                <VerticalStackLayout
                    Padding="32"
                    Spacing="12"
                    HorizontalOptions="Center"
                    VerticalOptions="Center">
                    <Border
                        WidthRequest="72"
                        HeightRequest="72"
                        BackgroundColor="#1F2338"
                        StrokeThickness="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="24" />
                        </Border.StrokeShape>
                        <Label
                            Text="ðŸ”"
                            FontSize="32"
                            HorizontalOptions="Center"
                            VerticalOptions="Center" />
                    </Border>
                    <Label
                        Text="Noch keine EintrÃ¤ge"
                        FontSize="18"
                        FontAttributes="Bold"
                        HorizontalTextAlignment="Center"
                        TextColor="#DDE1FF" />
                    <Label
                        Text="FÃ¼ge deinen ersten Zugang hinzu, um ihn sicher aufzubewahren."
                        FontSize="14"
                        HorizontalTextAlignment="Center"
                        TextColor="#AEB5DA" />
                </VerticalStackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:PasswordVaultEntry">
                    <Border
                        Margin="0,0,0,22"
                        Padding="22"
                        StrokeThickness="0"
                        BackgroundColor="#1B2036">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="26" />
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="#25000000" Radius="18" Offset="0,12" />
                        </Border.Shadow>
                        <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="14">
                            <Grid ColumnDefinitions="*,Auto" RowSpacing="0">
                                <VerticalStackLayout Spacing="6">
                                    <Label
                                        Text="{Binding Label}"
                                        FontSize="20"
                                        FontAttributes="Bold"
                                        TextColor="White" />
                                    <Border
                                        Padding="10,4"
                                        BackgroundColor="#2A2F4A"
                                        StrokeThickness="0"
                                        HorizontalOptions="Start">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="14" />
                                        </Border.StrokeShape>
                                        <Label
                                            Text="{Binding DisplayCategory}"
                                            FontSize="12"
                                            TextColor="#B6BCE3" />
                                    </Border>
                                </VerticalStackLayout>

                                <HorizontalStackLayout
                                    Grid.Column="1"
                                    Spacing="10"
                                    VerticalOptions="Start"
                                    HorizontalOptions="End">
                                    <Border
                                        WidthRequest="42"
                                        HeightRequest="42"
                                        BackgroundColor="#2C3352"
                                        StrokeThickness="0"
                                        VerticalOptions="Center">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="16" />
                                        </Border.StrokeShape>
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer
                                                Tapped="OnEditEntryTapped"
                                                CommandParameter="{Binding .}" />
                                        </Border.GestureRecognizers>
                                        <Label
                                            Text="âœ"
                                            FontSize="18"
                                            HorizontalOptions="Center"
                                            VerticalOptions="Center"
                                            TextColor="#DCE0FF" />
                                    </Border>
                                    <Border
                                        WidthRequest="42"
                                        HeightRequest="42"
                                        BackgroundColor="#3B2232"
                                        StrokeThickness="0"
                                        VerticalOptions="Center">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="16" />
                                        </Border.StrokeShape>
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer
                                                Tapped="OnDeleteEntryTapped"
                                                CommandParameter="{Binding .}" />
                                        </Border.GestureRecognizers>
                                        <Label
                                            Text="ðŸ—‘"
                                            FontSize="18"
                                            HorizontalOptions="Center"
                                            VerticalOptions="Center"
                                            TextColor="#FFD6D6" />
                                    </Border>
                                </HorizontalStackLayout>
                            </Grid>

                            <Grid
                                Grid.Row="1"
                                ColumnDefinitions="Auto,*"
                                ColumnSpacing="12"
                                IsVisible="{Binding Username, Converter={StaticResource StringNotNullOrWhiteSpaceConverter}}">
                                <Label
                                    Text="Benutzer"
                                    FontSize="13"
                                    TextColor="#A8ACCD"
                                    FontAttributes="Bold"
                                    VerticalOptions="Center" />
                                <Label
                                    Grid.Column="1"
                                    Text="{Binding Username}"
                                    FontSize="15"
                                    TextColor="#ECEFFF"
                                    LineBreakMode="TailTruncation" />
                            </Grid>

                            <Grid
                                Grid.Row="2"
                                ColumnDefinitions="Auto,*"
                                ColumnSpacing="12"
                                IsVisible="{Binding Password, Converter={StaticResource StringNotNullOrWhiteSpaceConverter}}">
                                <Label
                                    Text="Passwort"
                                    FontSize="13"
                                    TextColor="#A8ACCD"
                                    FontAttributes="Bold"
                                    VerticalOptions="Center" />
                                <Grid Grid.Column="1" ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">
                                    <Label
                                        FontSize="15"
                                        TextColor="#ECEFFF"
                                        LineBreakMode="NoWrap">
                                        <Label.Triggers>
                                            <DataTrigger TargetType="Label" Binding="{Binding IsPasswordVisible}" Value="True">
                                                <Setter Property="Text" Value="{Binding Password}" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Label" Binding="{Binding IsPasswordVisible}" Value="False">
                                                <Setter Property="Text" Value="{Binding Password, Converter={StaticResource PasswordMaskConverter}}" />
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>
                                    <Border
                                        Grid.Column="1"
                                        Padding="10,4"
                                        BackgroundColor="#2C3352"
                                        StrokeThickness="0"
                                        VerticalOptions="Center">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="14" />
                                        </Border.StrokeShape>
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer
                                                Tapped="OnTogglePasswordVisibilityTapped"
                                                CommandParameter="{Binding .}" />
                                        </Border.GestureRecognizers>
                                        <Label
                                            FontSize="12"
                                            TextColor="#CED4FF"
                                            Text="Anzeigen">
                                            <Label.Triggers>
                                                <DataTrigger TargetType="Label" Binding="{Binding IsPasswordVisible}" Value="True">
                                                    <Setter Property="Text" Value="Verbergen" />
                                                </DataTrigger>
                                            </Label.Triggers>
                                        </Label>
                                    </Border>
                                    <Border
                                        Grid.Column="2"
                                        Padding="10,4"
                                        BackgroundColor="#2C3352"
                                        StrokeThickness="0"
                                        VerticalOptions="Center">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="14" />
                                        </Border.StrokeShape>
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer
                                                Tapped="OnCopyPasswordTapped"
                                                CommandParameter="{Binding .}" />
                                        </Border.GestureRecognizers>
                                        <Label
                                            Text="Kopieren"
                                            FontSize="12"
                                            TextColor="#CED4FF" />
                                    </Border>
                                </Grid>
                            </Grid>

                            <Grid
                                Grid.Row="3"
                                ColumnDefinitions="Auto,*"
                                ColumnSpacing="12"
                                IsVisible="{Binding Url, Converter={StaticResource StringNotNullOrWhiteSpaceConverter}}">
                                <Label
                                    Text="URL"
                                    FontSize="13"
                                    TextColor="#A8ACCD"
                                    FontAttributes="Bold"
                                    VerticalOptions="Center" />
                                <Label
                                    Grid.Column="1"
                                    Text="{Binding Url}"
                                    FontSize="15"
                                    TextColor="#58A7FF"
                                    TextDecorations="Underline">
                                    <Label.GestureRecognizers>
                                        <TapGestureRecognizer
                                            CommandParameter="{Binding Url}"
                                            Tapped="OnOpenUrl" />
                                    </Label.GestureRecognizers>
                                </Label>
                            </Grid>

                            <VerticalStackLayout Grid.Row="4" Spacing="10">
                                <Label
                                    Text="{Binding Notes}"
                                    FontSize="14"
                                    TextColor="#C9CCE8"
                                    LineBreakMode="WordWrap">
                                    <Label.Triggers>
                                        <Trigger TargetType="Label" Property="Text" Value="">
                                            <Setter Property="IsVisible" Value="False" />
                                        </Trigger>
                                        <Trigger TargetType="Label" Property="Text" Value="{x:Null}">
                                            <Setter Property="IsVisible" Value="False" />
                                        </Trigger>
                                    </Label.Triggers>
                                </Label>

                                <Label
                                    Text="{Binding FreeText}"
                                    FontSize="14"
                                    TextColor="#C9CCE8"
                                    LineBreakMode="WordWrap">
                                    <Label.Triggers>
                                        <Trigger TargetType="Label" Property="Text" Value="">
                                            <Setter Property="IsVisible" Value="False" />
                                        </Trigger>
                                        <Trigger TargetType="Label" Property="Text" Value="{x:Null}">
                                            <Setter Property="IsVisible" Value="False" />
                                        </Trigger>
                                    </Label.Triggers>
                                </Label>

                                <Label
                                    Text="{Binding LocalModifiedAt, StringFormat='GeÃ¤ndert: {0:G}'}"
                                    FontSize="11"
                                    TextColor="#8E93BA"
                                    HorizontalOptions="End" />
                            </VerticalStackLayout>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>

        <Grid HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">
            <Button
                HorizontalOptions="End"
                VerticalOptions="End"
                Margin="0,0,24,32"
                WidthRequest="64"
                HeightRequest="64"
                CornerRadius="32"
                BackgroundColor="#4A5CFF"
                Text="ï¼‹"
                FontSize="28"
                TextColor="White"
                Clicked="OnAddEntryClicked"
                IsVisible="{Binding IsUnlocked}"
                SemanticProperties.Hint="Neuen Tresor-Eintrag hinzufÃ¼gen">
                <Button.Shadow>
                    <Shadow Brush="#55000000" Radius="24" Offset="0,12" />
                </Button.Shadow>
            </Button>
        </Grid>

        <Border
            Padding="24,48,24,32"
            BackgroundColor="#CC0B0D1A"
            IsVisible="{Binding IsLocked}"
            HorizontalOptions="FillAndExpand"
            VerticalOptions="FillAndExpand">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="42" />
            </Border.StrokeShape>
            <Border.Shadow>
                <Shadow Brush="#55000000" Radius="32" Offset="0,18" />
            </Border.Shadow>
            <ScrollView>
                <VerticalStackLayout Spacing="22" VerticalOptions="Center" HorizontalOptions="Center">
                    <Border
                        Padding="14,10"
                        StrokeThickness="0"
                        BackgroundColor="#1F2338"
                        HorizontalOptions="Start">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="16" />
                        </Border.StrokeShape>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnBackTapped" />
                        </Border.GestureRecognizers>
                        <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                            <Label
                                Text="â†"
                                FontSize="16"
                                TextColor="#CFD3FF" />
                            <Label
                                Text="Zur Startseite"
                                FontSize="14"
                                TextColor="#CFD3FF" />
                        </HorizontalStackLayout>
                    </Border>

                    <VerticalStackLayout Spacing="10" HorizontalOptions="Center" VerticalOptions="Center">
                        <Label
                            Text="Tresor gesperrt"
                            FontSize="26"
                            FontAttributes="Bold"
                            TextColor="White"
                            HorizontalTextAlignment="Center" />
                        <Label
                            Text="Bitte gib dein Master-Passwort ein, um den Tresor zu entsperren."
                            FontSize="14"
                            TextColor="#C4C8E8"
                            HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>

                    <VerticalStackLayout Spacing="14">
                        <Entry
                            Text="{Binding Password}"
                            IsPassword="True"
                            Placeholder="Master-Passwort"
                            PlaceholderColor="#8489B0"
                            TextColor="White"
                            BackgroundColor="#1F243C"
                            HeightRequest="48"
                            Margin="0,6"
                            HorizontalOptions="Fill" />
                        <Entry
                            Text="{Binding ConfirmPassword}"
                            IsVisible="{Binding IsNewVault}"
                            IsPassword="True"
                            Placeholder="Passwort bestÃ¤tigen"
                            PlaceholderColor="#8489B0"
                            TextColor="White"
                            BackgroundColor="#1F243C"
                            HeightRequest="48"
                            Margin="0,6"
                            HorizontalOptions="Fill" />

                        <Label
                            Text="{Binding UnlockError}"
                            TextColor="#FF9A9A"
                            FontSize="12"
                            IsVisible="{Binding UnlockError, Converter={StaticResource StringNotNullOrWhiteSpaceConverter}}"
                            HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>

                    <VerticalStackLayout Spacing="12">
                        <Grid ColumnDefinitions="Auto,*" IsVisible="{Binding CanUseBiometric}">
                            <Switch
                                Grid.Column="0"
                                IsToggled="{Binding EnableBiometric}" />
                            <Label
                                Grid.Column="1"
                                Text="Biometrische Anmeldung fÃ¼r diesen Tresor speichern"
                                FontSize="12"
                                TextColor="#D7DBF7"
                                Margin="12,0,0,0"
                                VerticalOptions="Center"
                                LineBreakMode="WordWrap" />
                        </Grid>

                        <Button
                            Text="Tresor entsperren"
                            Command="{Binding UnlockCommand}"
                            HeightRequest="52"
                            FontAttributes="Bold"
                            BackgroundColor="#4A5CFF"
                            TextColor="White"
                            CornerRadius="18" />

                        <Button
                            Text="Mit Fingerabdruck entsperren"
                            Command="{Binding UnlockWithBiometricCommand}"
                            HeightRequest="52"
                            CornerRadius="18"
                            BackgroundColor="#1F243C"
                            TextColor="#D7DBF7"
                            BorderColor="#3B4AD1"
                            BorderWidth="1"
                            IsVisible="{Binding CanUseBiometric}" />
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </ScrollView>
        </Border>
    </Grid>
</ContentPage>
